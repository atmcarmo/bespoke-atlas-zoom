Build phase:
  stages:
    Unit Tests:
      type: tests
      steps:
        - k8s-ci/load-env.sh stg
        - k8s-ci/unit-tests.sh
    Build STG:
      steps:
        - k8s-ci/load-env.sh stg
        - k8s-ci/build.sh stg
      when:
        - staging
    Build QA:
      steps:
        - k8s-ci/load-env.sh qa
        - k8s-ci/build.sh qa
      when:
        - master
    Build PRD:
      steps:
        - k8s-ci/load-env.sh prd
        - k8s-ci/build.sh prd
      when:
        - ^v[0-9]+\.[0-9]+\.[0-9]+(-RC\.[0-9]+)?$
    Raw Push:
      type: raw_push
      when:
        - staging
        - master
        - ^v[0-9]+\.[0-9]+\.[0-9]+(-RC\.[0-9]+)?$
Deploy phase:
  stg:
    deploy mode: automatic
    stages:
      Upload STG:
        type: deploy_s3
        when:
          - staging
  qa:
    deploy mode: automatic
    stages:
      Upload QA:
        type: deploy_s3
        when:
          - master
  prd:
    deploy mode: automatic
    stages:
      Upload PRD:
        type: deploy_s3
        when:
          - ^v[0-9]+\.[0-9]+\.[0-9]+(-RC\.[0-9]+)?$